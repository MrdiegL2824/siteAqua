<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Sistema Operacional M√≥vel ‚Äî Simula√ß√£o Avan√ßada</title>
  <style>
    /* 1. Vari√°veis CSS (Temas Base) */
    :root{
      --bg: #061220; --accent: #0ea5ff; --glass: rgba(255,255,255,0.06);
      --card: #0b1220; --muted: rgba(255,255,255,0.65);
      --icon-bg: rgba(255,255,255,0.03);
      --wallpaper: url('https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=800&q=60');
      font-family: Inter, Roboto, system-ui, -apple-system, "Segoe UI", "Helvetica Neue", Arial;
    }
    
    /* Temas Personalizados */
    .theme-green { --accent: #22c55e; --wallpaper: url('https://images.unsplash.com/photo-1555437021-a3f295b92706?auto=format&fit=crop&w=800&q=60'); }
    .theme-pink { --accent: #ec4899; --wallpaper: url('https://images.unsplash.com/photo-1601700683058-24300e84b7a4?auto=format&fit=crop&w=800&q=60'); }
    .theme-red { --accent: #ff4d4d; --wallpaper: url('https://images.unsplash.com/photo-1557682224-ce003ac55850?auto=format&fit=crop&w=800&q=60'); }
    
    /* 2. Estilos Gerais e Desktop Wrapper */
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#051023 0%, #081226 100%);color:#fff;display:flex;align-items:center;justify-content:center}
    
    .desktop-wrap{display:flex;gap:40px;padding:20px;align-items:flex-start}

    /* 3. Estrutura do Telefone */
    .phone-wrap{width:360px;height:780px;border-radius:34px;overflow:hidden;box-shadow:0 30px 80px rgba(2,6,23,0.7);border:1px solid rgba(255,255,255,0.03);position:relative;background-image:var(--wallpaper);background-size:cover;transition:background-image 0.5s ease}

    /* Barra de Status */
    .statusbar{height:36px;padding:6px 12px;display:flex;align-items:center;justify-content:space-between;font-size:12px;color:var(--muted);backdrop-filter:blur(6px);position:relative;z-index:10}
    .battery .level{transition:width 0.3s ease}

    /* Pain√©is (Notifica√ß√µes/Quick Settings) */
    .panel{position:absolute;left:12px;right:12px;background:linear-gradient(180deg,rgba(2,6,23,0.95), rgba(8,12,28,0.98));z-index:60;padding:12px;border-radius:12px;box-shadow:0 20px 40px rgba(0,0,0,0.6);backdrop-filter:blur(10px);opacity:0;pointer-events:none;transition:opacity 0.2s ease, transform 0.3s ease}
    .panel.visible{opacity:1;pointer-events:auto;transform:translateY(0)!important}
    
    /* Posi√ß√£o dos Pain√©is */
    .notif-panel{top:36px;height:42%;overflow-y:auto;transform:translateY(-10px);}
    .quick-panel{top:36px;height:auto;transform:translateY(-10px);}
    
    /* Quick Tiles */
    .quick-row{display:flex;gap:8px;flex-wrap:wrap}
    .quick-tile{flex:0 0 70px;height:70px;border-radius:12px;background:var(--icon-bg);display:flex;align-items:center;justify-content:center;flex-direction:column;font-size:12px;cursor:pointer;transition:background-color 0.2s ease, transform 0.1s ease}
    .quick-tile.active{background:var(--accent)!important;color:#fff;box-shadow:0 0 10px rgba(var(--accent), 0.3)}
    .quick-tile:active{transform:scale(0.95)}

    /* Tela Inicial (Homescreen) */
    .homescreen{padding:12px;padding-top:0;height:calc(100% - 36px);display:flex;flex-direction:column;position:relative;z-index:5}

    /* Dock */
    .dock{height:76px;border-radius:18px;background:linear-gradient(180deg, rgba(255,255,255,0.035), rgba(255,255,255,0.02));display:flex;align-items:center;justify-content:space-around;padding:8px;margin:10px;border:1px solid rgba(255,255,255,0.02);backdrop-filter:blur(10px)}
    .dock .icon{width:56px;height:56px;padding:0;gap:0}
    .dock .icon span{display:none}

    /* Janela de Aplicativo */
    .app-window{position:absolute;inset:36px 12px 12px 12px;background:linear-gradient(180deg,#072033, #071423);border-radius:16px;padding:12px;box-shadow:0 30px 60px rgba(2,6,23,0.6);display:none;flex-direction:column;z-index:70;backdrop-filter: blur(6px);transform-origin:bottom center;animation:openApp .25s cubic-bezier(0.25, 0.46, 0.45, 0.94) both}
    @keyframes openApp{from{transform:scale(0.9) translateY(20px);opacity:0}to{transform:scale(1) translateY(0);opacity:1}}
    
    .app-content{flex:1;overflow-y:auto;padding:6px}
    .close-btn{transition:color 0.2s ease}
    .close-btn:hover{color:var(--accent)}

    /* Gaveta de Apps (App Drawer) */
    .app-drawer{position:absolute;left:12px;right:12px;bottom:12px;height:48%;background:linear-gradient(180deg,rgba(2,6,23,0.95), rgba(8,12,28,0.98));border-radius:16px;padding:12px;z-index:65;backdrop-filter:blur(8px);overflow-y:auto;transition:transform 0.3s ease;transform:translateY(100%);opacity:0}
    .app-drawer.visible{transform:translateY(0);opacity:1}
    .drawer-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
    .app-drawer .icon{height:72px}
    
    /* Utilit√°rios */
    .setting-row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.05)}
    .setting-row:last-child{border-bottom:none}
    .setting-toggle{width:40px;height:24px;border-radius:12px;background:var(--muted);position:relative;cursor:pointer;transition:background-color 0.3s ease}
    .setting-toggle.active{background:var(--accent)}
    .setting-toggle::after{content:'';position:absolute;top:2px;left:2px;width:20px;height:20px;border-radius:50%;background:#fff;transition:transform 0.3s ease}
    .setting-toggle.active::after{transform:translateX(16px)}
    
    /* Control Panel */
    .control-panel{background:var(--card);padding:20px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6);width:300px;border:1px solid rgba(255,255,255,0.05)}
    .control-panel h3{color:var(--accent);margin-top:0}
    .theme-selector{display:flex;flex-direction:column;gap:10px;margin-bottom:20px}
    .theme-btn{padding:8px 12px;border:1px solid var(--muted);border-radius:8px;cursor:pointer;background:transparent;color:var(--muted);transition:all 0.2s ease}
    .theme-btn.active{border-color:var(--accent);color:var(--accent);font-weight:bold}
    .shortcuts-list li{margin-bottom:8px}

  </style>
</head>
<body>
  <div class="desktop-wrap">

    <div class="control-panel">
      <h3>üé® Personaliza√ß√£o e Controle</h3>
      <p style="font-size:12px;color:var(--muted)">Altere o tema do SO m√≥vel:</p>
      <div class="theme-selector" id="themeSelector">
        <button class="theme-btn active" data-theme="default">üîµ Padr√£o (Azul)</button>
        <button class="theme-btn" data-theme="green">üü¢ Cosmic Green</button>
        <button class="theme-btn" data-theme="pink">üü£ Neon Pink</button>
        <button class="theme-btn" data-theme="red">üî¥ Solar Red</button>
      </div>
      <hr style="border-color:rgba(255,255,255,0.1)">
      <h3>‚å®Ô∏è Atalhos de Teclado (Bot√µes R√°pidos)</h3>
      <ul class="shortcuts-list" style="list-style:none;padding:0;font-size:14px">
        <li><strong>L</strong>: Travar / Destravar Tela</li>
        <li><strong>N</strong>: Abrir Notifica√ß√µes (Swipe Down)</li>
        <li><strong>Q</strong>: Abrir Configura√ß√µes R√°pidas</li>
        <li><strong>D</strong>: Abrir / Fechar Gaveta de Apps (Swipe Up)</li>
        <li><strong>Esc</strong>: Fechar App Ativo / Fechar Pain√©is</li>
      </ul>
    </div>

    <div class="phone-wrap" id="phone">

      <div class="statusbar">
        <div class="status-left"><div id="carrier">Vivo</div><div>‚Ä¢</div><div id="signal">4G</div></div>
        <div class="status-right"><div id="time">12:45</div>
          <div class="battery"><div class="bar"><div class="level" id="batteryLevel" style="width:78%"></div></div><div style="font-size:11px;color:var(--muted)" id="batteryPct">78%</div></div>
          <div class="notif-toggle" id="openNotifs" style="cursor:pointer">üîî</div>
          <div class="quick-toggle" id="openQuick" style="cursor:pointer">‚öô</div>
        </div>
      </div>

      <div class="panel notif-panel" id="notifPanel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <strong>Notifica√ß√µes Recentes</strong>
          <button id="closeNotifs" class="close-btn">‚úï</button>
        </div>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:8px;padding:8px;border-radius:8px;background:var(--icon-bg)">
          <img src="https://dummyimage.com/48x48/10b981/fff&text=M" style="width:44px;height:44px;border-radius:8px">
          <div><strong>Mensagens</strong><div style="color:var(--muted);font-size:13px">Nova mensagem de Ana: "Tudo certo para amanh√£?"</div></div>
        </div>
        <div style="padding:8px;border-radius:8px;background:var(--icon-bg);margin-bottom:6px">
          <strong style="color:var(--accent)">Atualiza√ß√£o do Sistema:</strong> Reinicializa√ß√£o necess√°ria para finalizar.
        </div>
      </div>

      <div class="panel quick-panel" id="quickPanel">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
          <strong>Controles de Sistema</strong>
          <button id="closeQuick" class="close-btn">‚úï</button>
        </div>
        <div class="quick-row">
          <div class="quick-tile" data-toggle="wifi" id="quickWifi">Wi‚ÄëFi<br><small>Desativado</small></div>
          <div class="quick-tile" data-toggle="bluetooth" id="quickBluetooth">Bluetooth<br><small>Desativado</small></div>
          <div class="quick-tile" data-toggle="flashlight" id="quickFlashlight">Lanterna</div>
          <div class="quick-tile" data-toggle="airplane" id="quickAirplane">Modo Avi√£o</div>
          <div class="quick-tile" data-toggle="saver" id="quickSaver">Economia</div>
          <div class="quick-tile" data-toggle="location" id="quickLocation">Localiza√ß√£o</div>
        </div>
        <div style="margin-top:15px;color:var(--muted);font-size:12px;display:flex;align-items:center">
          Brilho
          <input type="range" id="brightness" min="10" max="100" value="80" style="width:100%;margin-top:0px;cursor:pointer;margin-left:10px">
        </div>
      </div>

      <div class="lock-screen" id="lockScreen" style="position:absolute;inset:0;background:linear-gradient(180deg,#02121f 0%, #031428 100%);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:80">
        <div class="lock-time" id="lockTime" style="font-size:56px;font-weight:600">12:45</div>
        <div class="lock-date" id="lockDate" style="margin-top:6px;color:var(--muted)">Ter√ßa-feira, 18 de Novembro</div>
        <div class="unlock-tip" style="position:absolute;bottom:30px;color:var(--muted);font-size:13px">Toque duas vezes para desbloquear</div>
      </div>

      <div class="homescreen" id="homescreen">
        <div class="searchbar">
          <img src="data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' width='18' height='18' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'><circle cx='11' cy='11' r='7'/><line x1='21' y1='21' x2='16.65' y2='16.65'/></svg>" alt="search">
          <input placeholder="Procurar apps, configura√ß√µes..." id="searchInput">
        </div>

        <div class="widgets">
          <div class="widget center clock-widget" id="smallClock">12:45</div>
          <div class="widget">
            <div style="display:flex;align-items:center;justify-content:space-between">
              <div style="display:flex;align-items:center">
                <span class="weather-widget-icon" style="font-size:24px;margin-right:8px">üåßÔ∏è</span> 
                <div style="font-size:24px;font-weight:600">20¬∞C</div>
              </div>
              <div style="color:var(--muted);font-size:12px;text-align:right">
                Chuva<br>Itaja√≠, SC
              </div>
            </div>
          </div>
        </div>

        <div class="icons-grid" id="iconsGrid">
        </div>

        <div class="dock">
        </div>

      </div>

      <div class="app-drawer" id="appDrawer">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px"><strong>Todos os apps</strong><button id="closeDrawer" class="close-btn">‚úï</button></div>
        <div class="drawer-grid" id="drawerGrid">
        </div>
      </div>

      <div class="app-window" id="appWindow">
        <div class="app-header">
          <strong id="appTitle">App</strong>
          <div><button class="close-btn" id="closeApp">‚úï</button></div>
        </div>
        <div class="app-content" id="appContent">
        </div>
      </div>

      <div class="context-menu" id="ctxMenu">
        <button id="ctxOpen">Abrir</button>
        <button id="ctxInfo">Informa√ß√µes do App</button>
        <button id="ctxRemove">Desinstalar</button>
      </div>

    </div>
  </div>

  <script>
    
    // ===================================
    // 1. ESTADO GLOBAL DO SIMULADOR
    // ===================================

    const appState = {
        locked: true,
        battery: { level: 78, isCharging: false },
        quickSettings: {
            wifi: false,
            bluetooth: false,
            flashlight: false,
            airplane: false,
            saver: false,
            location: true
        },
        activeApp: null,
        activePanel: null // 'notif', 'quick', 'drawer'
    };

    // 2. Defini√ß√£o dos Aplicativos (Database)
    const apps = [
      {id:'phone', name:'Telefone', color:'0ea5ff', dock: true, content: `<h3>üìû Chamadas Recentes</h3><p>Maria (M√≥vel) - 12:00<br>Suporte (Fixo) - 10:30</p><div style="margin-top:15px;padding:10px;background:var(--icon-bg);border-radius:8px"><strong>Teclado de Discagem Simulada</strong></div>`},
      {id:'messages', name:'Mensagens', color:'10b981', dock: true, content: `<h3>üí¨ Conversas (3 Novas)</h3><p><strong>Ana:</strong> Tudo certo para amanh√£? (Agora)<br><strong>Professor:</strong> Lembrete do Trabalho (Ontem)</p><div style="margin-top:15px;color:var(--muted)">Clique em um contato para simular a conversa.</div>`},
      {id:'browser', name:'Navegador', color:'f59e0b', dock: true, content: `<h3>üåê Navegador Web</h3><input type="text" value="https://simulacao.dev" style="width:100%;padding:10px;border-radius:8px;background:var(--icon-bg);border:none;color:#fff;margin-bottom:10px"><p>Barra de endere√ßo simulada. Use este espa√ßo para demonstrar conte√∫do web.</p>`},
      {id:'camera', name:'C√¢mera', color:'ef4444', dock: true, content: `<h3>üì∏ C√¢mera</h3><div style="height:350px;background:#000;display:flex;align-items:center;justify-content:center;color:#fff;font-size:18px;border-radius:8px">Visor em Tempo Real (Simulado)</div><p style="text-align:center;margin-top:10px"><button style="padding:10px 20px;border-radius:20px;background:var(--accent);border:none;color:#fff;cursor:pointer">Tirar Foto</button></p>`},
      {id:'music', name:'M√∫sica', color:'8b5cf6', dock: false, content:`<h3>üé∂ Player de M√∫sica</h3><p><strong>Artista:</strong> Mockup Beats<br><strong>Faixa:</strong> Lo-Fi Session #1</p><div><button id='playBtn' class='quick-tile' style='width:auto;margin-right:8px;padding:8px 12px;height:auto;margin-top:10px'>‚ñ∂Ô∏è Play</button> <button id='pauseBtn' class='quick-tile' style='width:auto;padding:8px 12px;height:auto'>‚è∏Ô∏è Pause</button></div><div id='track' style='margin-top:16px;color:var(--muted)'>Status: Pausado</div>`},
      {id:'files', name:'Arquivos', color:'3b82f6', dock: false, content:'<h3>üìÅ Meus Arquivos</h3><ul style="list-style:none;padding:0"><li>Documentos (12)</li><li>Imagens (56)</li><li>Downloads (5)</li></ul>'},
      {id:'store', name:'Loja', color:'06b6d4', dock: false, content:'<h3>üõçÔ∏è App Store</h3><p>Destaque: Jogo Simulador de UI.</p><p style="color:var(--accent)">Procure por novos apps!</p>'},
      {id:'notes', name:'Notas', color:'f97316', dock: false, content:'<h3>üìù Notas R√°pidas</h3><textarea placeholder="Sua nota aqui..." style="width:100%;height:200px;border-radius:8px;background:rgba(255,255,255,0.02);color:#fff;border:1px solid rgba(255,255,255,0.03);padding:10px"></textarea>'},
      {id:'clock', name:'Rel√≥gio', color:'fbbf24', dock: false, content:'<h3>‚è∞ Rel√≥gio Mundial</h3><p>S√£o Paulo: 12:45<br>Nova York: 10:45<br>T√≥quio: 00:45</p>'},
      {id:'settings', name:'Configura√ß√µes', color:'6b7280', dock: false, content: `<h3>‚öôÔ∏è Sistema</h3><div class="setting-row"><span>Wi-Fi</span><div class="setting-toggle" id="settingWifi"></div></div><div class="setting-row"><span>Bluetooth</span><div class="setting-toggle" id="settingBluetooth"></div></div><div class="setting-row"><span>Localiza√ß√£o</span><div class="setting-toggle active" id="settingLocation"></div></div><div class="setting-row"><span>Atualiza√ß√£o de Software</span><button style="background:var(--accent);color:#fff;padding:4px 8px;border:none;border-radius:6px;cursor:pointer">Verificar</button></div>`},
      {id:'calendar', name:'Calend√°rio', color:'ef4444', dock: false, content:'<h3>üìÖ Eventos</h3><p>18/Nov: Feriado Simulado<br>20/Nov: Apresenta√ß√£o de Projeto</p>'},
      {id:'maps', name:'Mapas', color:'10b981', dock: false, content:'<h3>üó∫Ô∏è Mapas</h3><div style="height:300px;background:#333;border-radius:8px;display:flex;align-items:center;justify-content:center">Visualiza√ß√£o de Mapa Simulado</div>'},
    ];

    // 3. Elementos DOM e Inicializa√ß√£o
    const $ = id => document.getElementById(id);
    const $$ = selector => document.querySelector(selector);

    const phoneWrap = $('phone');
    const iconsGrid = $('iconsGrid');
    const dockEl = $$('.dock');
    const drawerGrid = $('drawerGrid');
    const appWindow = $('appWindow');
    const appTitle = $('appTitle');
    const appContent = $('appContent');
    const lockScreen = $('lockScreen');
    const appDrawer = $('appDrawer');
    const notifPanel = $('notifPanel');
    const quickPanel = $('quickPanel');
    const searchInput = $('searchInput');

    // Inicializa a renderiza√ß√£o
    renderIcons(); 
    renderDrawer();
    updateUIFromState();
    
    // Define a hora inicial com base no contexto
    let initialDate = new Date();
    initialDate.setFullYear(2025, 10, 18); // Ano: 2025, M√™s: Nov (10), Dia: 18
    initialDate.setHours(12, 45, 0); // Hora: 12:45:00
    updateClock(initialDate); 

    // ===================================
    // 4. FUN√á√ïES DE ESTADO E UI
    // ===================================

    // Atualiza Quick Tiles e Configura√ß√µes de Apps com base no estado
    function updateQuickTile(key) {
        const tile = $(`quick${key.charAt(0).toUpperCase() + key.slice(1)}`);
        if (!tile) return;
        
        const isActive = appState.quickSettings[key];
        tile.classList.toggle('active', isActive);
        
        // Atualiza texto se houver small tag (Wi-Fi, Bluetooth)
        const smallEl = tile.querySelector('small');
        if (smallEl) {
            smallEl.textContent = isActive ? 'Ativo' : 'Desativado';
        }

        // Sincroniza o toggle do Quick Panel com o app de Configura√ß√µes
        const settingToggle = $(`setting${key.charAt(0).toUpperCase() + key.slice(1)}`);
        if (settingToggle) {
            settingToggle.classList.toggle('active', isActive);
        }
    }
    
    function updateUIFromState() {
        // Atualiza todos os Quick Tiles
        Object.keys(appState.quickSettings).forEach(updateQuickTile);

        // Atualiza a Bateria
        const level = appState.battery.level;
        $('batteryLevel').style.width = `${level}%`;
        $('batteryPct').textContent = `${level}%`;
        
        let color = '#6ee7b7'; 
        if (level < 20) color = '#ef4444'; 
        else if (level < 50) color = '#fbbf24'; 
        $('batteryLevel').style.background = `linear-gradient(90deg, var(--accent), ${color})`;
    }

    // Alterna o estado de uma configura√ß√£o e atualiza a UI
    function toggleSetting(key) {
        if (key === 'airplane') {
            const isActivating = !appState.quickSettings.airplane;
            appState.quickSettings.airplane = isActivating;

            if (isActivating) {
                // Modo Avi√£o: Desativa Wi-Fi e Bluetooth
                appState.quickSettings.wifi = false;
                appState.quickSettings.bluetooth = false;
            }
        } else if (appState.quickSettings.airplane) {
            // Se Modo Avi√£o estiver ativo, impede altera√ß√£o
            return;
        }

        appState.quickSettings[key] = !appState.quickSettings[key];
        updateUIFromState();
    }
    
    // Adiciona event listeners para Quick Tiles e App de Configura√ß√µes
    function setupInteraction() {
        Object.keys(appState.quickSettings).forEach(key => {
            const tile = $(`quick${key.charAt(0).toUpperCase() + key.slice(1)}`);
            if (tile) tile.addEventListener('click', () => toggleSetting(key));
        });

        // Adiciona listeners para toggles no app de Configura√ß√µes
        ['wifi', 'bluetooth', 'location'].forEach(key => {
            const settingToggle = $(`setting${key.charAt(0).toUpperCase() + key.slice(1)}`);
            if (settingToggle) settingToggle.addEventListener('click', () => toggleSetting(key));
        });
    }
    setupInteraction();

    // ===================================
    // 5. FUN√á√ïES DE NAVEGA√á√ÉO E UX
    // ===================================

    // Abre a Janela de Aplicativo
    function openApp(id){
      const app = apps.find(x=>x.id===id);
      if(!app || appState.locked) return;
      
      appState.activeApp = id;
      appTitle.textContent = app.name;
      appContent.innerHTML = app.content + `<p style=\"margin-top:12px;color:var(--muted);font-size:12px;padding-top:10px;border-top:1px solid rgba(255,255,255,0.05)\">Conte√∫do de demonstra√ß√£o ‚Äî personalize para o seu trabalho.</p>`;
      appWindow.style.display = 'flex';
      hideLock();
      hideAllPanels();

      // L√≥gica espec√≠fica para o app de M√∫sica
      if(id==='music'){
        const play = $('playBtn');
        const pause = $('pauseBtn');
        const track = $('track');
        if(play) play.addEventListener('click', ()=>track.textContent='üé∂ Tocando: Lo-Fi Session #1');
        if(pause) pause.addEventListener('click', ()=>track.textContent='‚è∏Ô∏è Status: Pausado');
      }
    }
    $('closeApp').addEventListener('click', ()=>{
        appWindow.style.display='none';
        appState.activeApp = null;
    });

    // Alternar pain√©is
    function hideAllPanels(){
        notifPanel.classList.remove('visible');
        quickPanel.classList.remove('visible');
        appDrawer.classList.remove('visible');
        appState.activePanel = null;
    }

    $('openNotifs').addEventListener('click', ()=>{
        if (appState.locked) return;
        if (appState.activePanel === 'notif') { hideAllPanels(); }
        else { hideAllPanels(); notifPanel.classList.add('visible'); appState.activePanel = 'notif'; }
    });
    $('closeNotifs').addEventListener('click', hideAllPanels);

    $('openQuick').addEventListener('click', ()=>{
        if (appState.locked) return;
        if (appState.activePanel === 'quick') { hideAllPanels(); }
        else { hideAllPanels(); quickPanel.classList.add('visible'); appState.activePanel = 'quick'; }
    });
    $('closeQuick').addEventListener('click', hideAllPanels);

    function toggleDrawer(){ 
        if (appState.locked || appState.activeApp) return;
        if (appState.activePanel === 'drawer') {
            appDrawer.classList.remove('visible');
            appState.activePanel = null;
        } else {
            hideAllPanels();
            appDrawer.classList.add('visible');
            appState.activePanel = 'drawer';
        }
    }
    $$('.homescreen').addEventListener('dblclick', toggleDrawer);
    $('closeDrawer').addEventListener('click', toggleDrawer);

    // Tela de Bloqueio
    function showLock(){ lockScreen.style.display='flex'; appState.locked=true; }
    function hideLock(){ 
        if (!appState.locked) return;
        lockScreen.style.display='none'; 
        appState.locked=false; 
    }
    lockScreen.addEventListener('dblclick', hideLock);
    showLock(); 

    // ===================================
    // 6. FUN√á√ïES VISUAIS E REL√ìGIO
    // ===================================

    // Atualiza a hora e data
    function updateClock(d = new Date()) {
      const hh = String(d.getHours()).padStart(2,'0');
      const mm = String(d.getMinutes()).padStart(2,'0');
      
      const options = { weekday:'long', day:'2-digit', month:'long' };
      const dateString = d.toLocaleDateString('pt-BR', options).replace(/,/, '');

      $('time').textContent = `${hh}:${mm}`;
      $('lockTime').textContent = `${hh}:${mm}`;
      $('lockDate').textContent = dateString;
      $('smallClock').textContent = `${hh}:${mm}`;

      // Simula o avan√ßo do tempo (1 minuto por segundo real)
      initialDate.setMinutes(initialDate.getMinutes() + 1);
      // Se n√£o estivermos usando a data de simula√ß√£o, use Date() real.
      // Neste caso, mantemos a data de 18/11/2025 para consist√™ncia do mockup.
    }
    
    // Roda a simula√ß√£o do rel√≥gio a cada 1000ms (1 segundo)
    setInterval(() => updateClock(initialDate), 1000); 


    // 7. Renderiza√ß√£o Din√¢mica (√çcones)
    function createIconEl(a, isDock = false, isDrawer = false){
        const div = document.createElement('div');
        div.className='icon' + (isDrawer ? ' drawer-icon' : '');
        div.dataset.app = a.id;
        div.title = a.name;

        const iconText = isDock ? a.name.substring(0, 3).toUpperCase() : a.name.charAt(0).toUpperCase();
        const imgSize = isDrawer ? '48x48' : '96x96';
        
        div.innerHTML = `
            <img src='https://dummyimage.com/${imgSize}/${a.color}/fff&text=${encodeURIComponent(iconText)}' alt='${a.name}'>
            <span>${a.name}</span>`;

        if(a.id === 'messages' && !isDrawer) {
            div.classList.add('badge');
            div.setAttribute('data-badge', '3');
        }
        
        // Event listeners (click/context menu logic...)
        // (Mantendo a l√≥gica de context menu e click do mockup anterior)
        
        div.addEventListener('click', (e)=>{ 
            if (div.dataset.contextActive === 'true') {
                div.dataset.contextActive = 'false';
                return;
            }
            openApp(a.id)
        });

        // Simplified Context Menu trigger (using native contextmenu event)
        div.addEventListener('contextmenu', (ev)=>{ ev.preventDefault(); showContextMenu(ev, a); });

        return div;
    }

    function renderIcons(filter=''){
      iconsGrid.innerHTML = '';
      dockEl.innerHTML = '';
      const list = apps.filter(a=>a.name.toLowerCase().includes(filter.toLowerCase()));
      
      const dockApps = list.filter(a => a.dock);
      dockApps.forEach(a => dockEl.appendChild(createIconEl(a, true)));

      const homeScreenApps = list.filter(a => !a.dock).slice(0, 8);
      homeScreenApps.forEach(a => iconsGrid.appendChild(createIconEl(a)));
    }

    function renderDrawer(){
      drawerGrid.innerHTML='';
      apps.sort((a, b) => a.name.localeCompare(b.name));
      apps.forEach(a=>{
        const el = createIconEl(a, false, true);
        el.style.width='100%';
        el.style.height='72px';
        drawerGrid.appendChild(el);
      });
    }

    // Busca (Filtra √≠cones)
    searchInput.addEventListener('input', (e)=>{ renderIcons(e.target.value); });

    // Menu de Contexto (simplificado para concis√£o)
    function showContextMenu(ev, app){
      let x = (ev.clientX || 120);
      let y = (ev.clientY || 240);
      const rect = phoneWrap.getBoundingClientRect();
      ctxMenu.style.left = (x - rect.left - 40) + 'px';
      ctxMenu.style.top = (y - rect.top - 20) + 'px';
      ctxMenu.style.display = 'block';
      ctxMenu.dataset.app = app.id;
    }
    const ctxMenu = $('ctxMenu');
    document.addEventListener('click', (e)=>{
        if(ctxMenu.style.display === 'block' && !ctxMenu.contains(e.target)){
            ctxMenu.style.display='none';
        }
    });
    $('ctxOpen').addEventListener('click', ()=>{openApp(ctxMenu.dataset.app); ctxMenu.style.display='none';});
    $('ctxInfo').addEventListener('click', ()=>{alert(`Informa√ß√µes do app: ${ctxMenu.dataset.app} (Simulado)`); ctxMenu.style.display='none';});
    $('ctxRemove').addEventListener('click', ()=>{alert(`Desinstalando (simulado): ${ctxMenu.dataset.app}`); ctxMenu.style.display='none';});


    // 8. Tema Personalizado (Fora do Simulador)
    const themeSelector = $('themeSelector');
    themeSelector.addEventListener('click', (e) => {
        if (e.target.classList.contains('theme-btn')) {
            const theme = e.target.dataset.theme;
            themeSelector.querySelectorAll('.theme-btn').forEach(btn => btn.classList.remove('active'));
            e.target.classList.add('active');
            
            phoneWrap.className = 'phone-wrap'; // Reset
            if (theme !== 'default') {
                phoneWrap.classList.add(`theme-${theme}`);
            }
        }
    });


    // 9. Atalhos e Gestos
    document.addEventListener('keydown', (e)=>{
      if(e.key==='Escape'){ 
        if(appWindow.style.display==='flex') $('closeApp').click(); 
        else if (appState.activePanel) hideAllPanels();
      }
      if(e.key.toLowerCase()==='l'){ appState.locked ? hideLock() : showLock(); }
      if(e.key.toLowerCase()==='n'){ $('openNotifs').click(); }
      if(e.key.toLowerCase()==='q'){ $('openQuick').click(); }
      if(e.key.toLowerCase()==='d'){ toggleDrawer(); }
    });

    let startY = null;
    let dragLock = false; 
    
    phoneWrap.addEventListener('touchstart', (ev)=>{
        if (appState.locked || appState.activeApp) return;
        startY = ev.touches[0].clientY;
        dragLock = false;
        // N√£o intercepta scroll em √°reas espec√≠ficas
        if (ev.target.closest('.app-content') || ev.target.closest('.notif-panel') || ev.target.closest('.app-drawer')) {
            startY = null; 
        }
    });

    phoneWrap.addEventListener('touchmove', (ev)=>{
      if(!startY || appState.locked) return;

      const dy = ev.touches[0].clientY - startY;
      
      if (Math.abs(dy) > 50 && !dragLock) { 
        dragLock = true;
        if(dy>100){ $('openNotifs').click(); } // Swipe Down
        else if(dy<-100){ toggleDrawer(); } // Swipe Up
      }
    });

    phoneWrap.addEventListener('touchend', ()=>{
        startY=null;
        dragLock=false;
    });

    // Roda uma atualiza√ß√£o inicial para garantir o estado correto
    updateUIFromState();
  </script>
</body>
</html>